@page "/registrarme"
@inject IBlogService blogService

@using simple_crud.Library.Models.DTOs

<h3>Registrarme</h3>

<form onsubmit="@OnSubmit">
    <label for="username">Nombre de usuario</label>
    <input type="text" id="username" @bind="Username" />

    <label for="password">Contraseña</label>
    <input type="password" id="password" @bind="Password" />

    <label for="confirmpassword">Confirmar contraseña</label>
    <input type="password" id="confirmpassword" @bind="ConfirmPassword" />

    <input type="submit" value="Confirmar" />
</form>

@if (!string.IsNullOrEmpty(ErrorMessage))
{
    <p style="color:red">@ErrorMessage</p>
}

@code {
    private string? Username { get; set; }
    private string? Password { get; set; }
    private string? ConfirmPassword { get; set; }
    private string ErrorMessage { get; set; } = string.Empty;

    private async Task OnSubmit()
    {
        // Validación manual
        if (Password != ConfirmPassword)
        {
            Console.WriteLine("Las contraseñas no coinciden");
            return;
        }

        var dto = new CreateUsuarioDTO
        {
            Username = Username!,
            Password = Password!
        };

        var operationRegister = await blogService.RegisterAsync(dto);

        if (!operationRegister.Success)
            ErrorMessage = operationRegister.Message!;
    }
}
